				***过程***



不同的编程语言中，过程的形式多样：函数(function)、方法(method)、子例程(subroutine)、处理函数(handler)等等，但它们都有一些共同的特性。

要提供对过程的机器级支持，必须要处理许多不同的属性。为了方便讨论，假设过程P调用过程Q，Q执行后返回到P。这些动作包括下面一个或多个机制：

​	<font style="font-weight:700;">传递控制</font>。在进入过程Q的时候，程序计数器必须被设置为Q的代码的起始地址，然后在返回时，要把程序计数器设置为P中调用Q后面那条指令的地址。

​	<font style="font-weight:700;">传递数据</font>。P必须能够向Q提供一个或多个参数，Q必须能够向P返回一个值。

​	<font style="font-weight:700;">分配和释放内存</font>。在开始时，Q可能需要为局部变量分配空间，而在返回前，又必须是放这些存储空间。



下表给出call和ret指令的一般形式：

| 指令                 |       描述       |
| -------------------- | :--------------: |
| call         label   |     过程调用     |
| call         Operand |     过程调用     |
| ret                  | 从过程调用中返回 |



call指令有一个目标，即指明被调用过程起始的指令地址。

x86-64中，可以通过寄存器最多传递6个整型(例如整数和指针)参数。寄存器的使用是有特殊顺序的，寄存器使用的名字取决于要传递的数据类型的大小，如图3-28所示。会根据参数在参数列表中的顺序为它们分配寄存器。

![](..\img\传递参数的寄存器.jpg)



如果一个函数有大于6个整形参数，超过6个的部分就要通过栈来传递。



有些时候局部数据必须放在内存中，常见的情况包括：
$$
\begin{align*}\label{1}
  & \bullet 寄存器不足够存放所有的本地数据。\\
  & \bullet 对一个局部变量使用地址运算符'\&'，因此必须能够为它产生一个地址。 \\
  & \bullet 某些局部变量是数组或结构，因此必须能够通过数组或结构引用被访问到。在描述数组和结构分配时，会讨论 \\&这个问题。
\end{align*}
$$



