## 动态内存分配

动态内存分配器维护着一个进程的虚拟内存区域，称为堆（heap）。

分配器将堆视为一组不同大小的块的集合来维护。每个块就是一个连续的虚拟内存片，要么是已分配的，要么是空闲的。

一般分配器有两种风格：

- **显示分配器**（explicit allocator）,要求应用显示地释放任何已分配的块。
- **隐式分配器**（implicit allocator），另一方面，要求分配器检测一个已分配块何时不再被程序所使用，那么久释放这个块。

显示分配器必须在一些相当严格的约束条件下工作：

	- **处理任意请求序列**。一个应用可以有任意的分配请求和释放请求序列，只要满足约束条件；每个释放请求必须对应于一个当前已分配块，这个块是由一个以前的分配请求获得的。因此，分配器不可以假设分配和释放请求的顺序。
	- **立即响应请求**。分配器必须立即响应分配请求。因此，不允许分配器为了提高性能重新排列或者缓冲请求。
	- **只使用堆**。为了使分配器是可扩展的，分配器使用的任何非标量数据结构都必须保存在堆里。
	- **对齐块（对齐要求）**。分配器必须是对齐块，使得它们可以保存任何类型的数据对象。
	- **不修改已分配的块**。分配器只能操作或者改变空闲块。

造成堆利用率低的主要原因是一种称为**碎片**的现象，当有未使用的内存但不能满足分配请求时，就发生这种现象。有两种形式的碎片：**内部碎片**（internal fragmentation）和**外部碎片**（external fragmentation）。

	- **内部碎片**是在一个已分配块比有效载荷大时发生的。
	- **外部碎片**是当空闲内存合计起来足够满足一个分配请求，但是没有一个单独的空闲块足够大可以来处理这个请求时发生的。
