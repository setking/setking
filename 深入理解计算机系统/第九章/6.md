											***地址翻译***



![](..\img\地址翻译.jpg)

这里包含了这节将要使用的所有符号。
$$
形式上来说，地址翻译是一个N元素的虚拟地址空间（VAS）中的元素和一个M元素的物理地址空间（PAS）中\\
元素之间的映射，\\
	MAP:VAS \rightarrow PAS \bigcup \emptyset \\
	
	这里 \\
		MAP(A) = \begin{cases} A' \quad 如果虚拟地址A处的数据在PAS的物理地址A'处 \\
		\emptyset \quad 如果虚拟地址A处的数据不在物理内存中
		\end{cases}
$$

![](D:\note\studyNote\深入理解计算机系统\img\页命中流程.jpg)

a) 展示了页命中时，CPU硬件执行的流程。

	- 第一步：处理器生成一个虚拟地址，并把它传送给MMU。
	- 第二步：MMU生成PTE地址，并从高速缓存/主存请求得到它。
	- 第三步：高速缓存/主存向MMU返回PTE。
	- 第四步：MMU构造物理地址，并把它传送给高速缓存/主存。
	- 第五步：高速缓存/主存返回所请求的数据字给处理器。

b)展示了缺页时，CPU硬件执行的流程。

- 第一步到第三步：和a的第一步到第三步的流程相同。
- 第四步：PTE中的有效位是零，所以MMU触发了一次异常，传递CPU中的控制到操作系统内核中的缺页异常处理程序。
- 第五步：缺页处理程序确定出物理内存中的牺牲页，如果这个页面已经被修改了，则把它换出到磁盘。
- 第六步：缺页处理程序页面调入新的页面，并更新内存中的PTE。
- 第七步：缺页处理程序返回到原来的进程，再次执行导致缺页的指令。CPU将引起缺页的虚拟地址重新发送给MMU。因为虚拟页面现在缓存在物理内存中，所以就会命中，在流程执行完之后，主存就会将所请求字返回给处理器。