            ***Y86-64的顺序实现***


​            

处理一条指令各个阶段以及各个阶段内执行操作的简略描述：

- **取指** (fetch):取指阶段从内存读取指令字节，地址为程序计数器(PC)的值。从指令中抽取出指令指示符字节的两个四位部分，称为icode(指令代码)和ifun(指令功能)。它可能取出一个寄存器指示符字节，指明一个或两个寄存器操作数指示符rA和rB。它还可能取出一个四字节常数字valC。它按顺序方式计算当前指令的下一条指令的地址valP。也就是说，valP等于PC的值加上已取出指令的长度。
- **译码**(decode):译码阶段从寄存器文件读入最多两个操作数，得到值valA和/或valB。通常，它读入指令rA和rB字段指明的寄存器，不过有些指令是读寄存器%rsp的。
- **执行**(execute):在执行阶段，算数/逻辑单元(ALU)要么执行指令指明的操作(根据ifun的值)， 计算内存引用的有效地址，要么增加或减少栈指针。得到的值我们称之为valE。在此，也可能设置条件码。对一条条件传送指令来说，这个阶段会检验条件码和传送条件(由ifun给出)，如果条件成立，则更新目标寄存器。同样，对一个跳转指令来说，这个阶段会决定是不是应该选择分支。、
- **访存**(memory):访存阶段可以将数据写入内存，或者从内存读出数据。读出的值为valM。
- **写回**(write  back):写回阶段最多可以写两个结果到寄存器文件。
- **更新PC**(PC update):将PC设置成下一条指令的地址。



下图给出了更详细的给出了实现SEQ所需硬件的完整的细节



![](D:\typora\page\StudyNote\深入理解计算机系统\img\SEQ硬件结构.jpg)

  - ***白色方框表示时钟寄存器***。程序计数器PC是SEQ中唯一的时钟寄存器。

  - ***浅蓝色方框表示硬件单元***。这包括内存、ALU等等。在我们所有的处理器实现中，都会使用这一组基本的单元。我们把这些单元当作“黑盒子”，不关心它们的细节设计。

  - ***控制逻辑块用灰色圆角矩形表示***。这些块用来从一组信号源中进行选择，或者用来计算一些布尔函数。

  - ***线路的名字在白色圆圈中说明***。它们只是线路的标识，而不是硬件单元。

  - ***宽度为字长的数据连接用中等粗度的线表示***。每条这样的线实际上都代表一簇64根线，并列地连接在一起，将一个字从硬件的一个部分传送到另一部分。

  - ***宽度为字节或更窄的数据连接用细线表示***。根据线上要携带的值得类型，每条这样的线实际上都代表一簇4根或8根线。

  - ***单个位的连接用虚线来表示***。这代表芯片上单元与块之间传递的控制值。

    ***

SEQ的实现包括组合逻辑和两种存储器设备：时钟寄存器(程序计数器和条件码寄存器)，随机访问存储器(寄存器文件、指令内存和数据内存)。组合逻辑不需要任何时序或控制————只需要输入变化了，值就通过逻辑门网络传播。

